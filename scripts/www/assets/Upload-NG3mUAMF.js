var e=Object.defineProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,o=(e,t,l)=>new Promise((a,s)=>{var o=e=>{try{r(l.next(e))}catch(t){s(t)}},n=e=>{try{r(l.throw(e))}catch(t){s(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,n);r((l=l.apply(e,t)).next())});import{r as n,w as r,o as i,G as u,p as d,q as c,O as p,P as m,A as y,C as g,x as v,v as b,K as f,L as h,u as x,c as w,E as k}from"./vue-vendor-DsBWIAOi.js";import{m as M}from"./mock-LZpIbfPd.js";import{u as C}from"./useToast-BxM8ikBu.js";import{_ as I}from"./index-BTSs0mnw.js";const j={class:"upload-page fade-in"},P={class:"px-4 py-3 bg-white border-b border-gray-200"},S={class:"flex space-x-2"},U=["onClick"],V={class:"px-4 py-4"},L={key:0,class:"space-y-3"},O={class:"bg-white p-3 rounded-xl shadow-sm"},D={key:0,class:"mb-2"},z={class:"grid grid-cols-4 gap-1.5 mb-2"},A=["src","alt"],E=["src"],B=["onClick"],N={key:0,class:"text-xs text-primary-600 font-medium mb-1"},H=["disabled"],R={key:1,class:"mb-3"},T={class:"flex items-center justify-between mb-1"},$={class:"text-xs font-medium text-primary-600"},J={class:"w-full bg-gray-200 rounded-full h-1.5"},_={class:"space-y-2"},q={class:"flex space-x-2"},F=["disabled"],W=["disabled"],G={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},K={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Q=["disabled"],X=["disabled"],Y={key:0,class:"flex items-center justify-center"},Z={key:1},ee={key:1,class:"space-y-4"},te={class:"bg-white p-4 rounded-xl shadow-sm"},le={class:"space-y-3"},ae=["disabled"],se=["disabled"],oe=["disabled"],ne=["disabled"],re=["disabled"],ie={key:2,class:"space-y-4"},ue={class:"bg-white p-4 rounded-xl shadow-sm"},de={class:"space-y-3"},ce=["disabled"],pe=["disabled"],me=["disabled"],ye=["disabled"],ge=["disabled"],ve=["disabled"],be=["disabled"],fe={key:3,class:"space-y-3"},he={key:0,class:"text-center py-8"},xe={key:1,class:"text-center py-12"},we={key:2,class:"space-y-3"},ke={class:"flex items-start justify-between mb-3"},Me={class:"flex-1"},Ce={class:"flex items-center space-x-2 mb-1"},Ie={class:"text-xs text-gray-500"},je={class:"text-sm font-medium text-gray-900"},Pe=["onClick"],Se={key:0,class:"text-sm text-gray-600 mb-3"},Ue={key:1,class:"text-xs text-gray-600 space-y-1 mb-3"},Ve={key:0},Le={key:1},Oe={key:2,class:"text-xs text-gray-600 space-y-1 mb-3"},De={key:0},ze={key:1},Ae={key:2},Ee={key:3},Be={key:4},Ne={key:5},He={key:3,class:"mb-3"},Re={class:"grid grid-cols-4 gap-2"},Te=["onClick"],$e=["src","alt"],Je={key:1,class:"w-full h-full flex items-center justify-center bg-gray-200"},_e={class:"text-xs text-gray-500 mt-2"},qe={key:4,class:"flex items-center space-x-1 text-xs text-gray-600 mb-2"},Fe={key:5,class:"flex items-center space-x-2"},We=I({__name:"Upload",setup(e){k();const I=C(),We=n("photo"),Ge=n(!1),Ke=n(0),Qe=n(null),Xe=n([]),Ye=n([]),Ze=n(!1),et=n(""),tt=n({type:"photo",description:"",location:""}),lt=n({title:"",content:"",deadline:"",responsible:""}),at=n({date:(new Date).toISOString().split("T")[0],situation:"",inspection:"",issues:"",measures:"",plan:""});function st(){var e;null==(e=Qe.value)||e.click()}function ot(e){const t=Array.from(e.target.files).filter(e=>e.type.startsWith("image/")||e.type.startsWith("video/"));0!==t.length?Xe.value.length+t.length>9?I.warning("最多只能上传9个文件"):(t.forEach(e=>{Xe.value.push(e);try{if(e.type.startsWith("image/")){const t=new FileReader;t.onerror=()=>{Ye.value.push({url:null,type:"image",name:e.name,error:!0})},t.onload=t=>{Ye.value.push({url:t.target.result,type:"image",name:e.name})},t.readAsDataURL(e)}else if(e.type.startsWith("video/"))try{const t=URL.createObjectURL(e);Ye.value.push({url:t,type:"video",name:e.name})}catch(t){Ye.value.push({url:null,type:"video",name:e.name,error:!0})}}catch(l){}}),I.success(`已选择 ${t.length} 个文件`)):I.warning("请选择图片或视频文件")}function nt(e,t){const l=6378245,a=.006693421622965943;if(s=e,(o=t)<72.004||o>137.8347||s<.8293||s>55.8271)return[e,t];var s,o;let n=function(e,t){let l=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return l+=2*(20*Math.sin(6*e*Math.PI)+20*Math.sin(2*e*Math.PI))/3,l+=2*(20*Math.sin(t*Math.PI)+40*Math.sin(t/3*Math.PI))/3,l+=2*(160*Math.sin(t/12*Math.PI)+320*Math.sin(t*Math.PI/30))/3,l}(t-105,e-35),r=function(e,t){let l=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return l+=2*(20*Math.sin(6*e*Math.PI)+20*Math.sin(2*e*Math.PI))/3,l+=2*(20*Math.sin(e*Math.PI)+40*Math.sin(e/3*Math.PI))/3,l+=2*(150*Math.sin(e/12*Math.PI)+300*Math.sin(e/30*Math.PI))/3,l}(t-105,e-35);const i=e/180*Math.PI;let u=Math.sin(i);u=1-a*u*u;const d=Math.sqrt(u);return n=180*n/(l*(1-a)/(u*d)*Math.PI),r=180*r/(l/d*Math.cos(i)*Math.PI),[e+n,t+r]}function rt(){return o(this,null,function*(){if(navigator.geolocation)if("https:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname){Ze.value=!0,I.info("正在获取位置...");try{const t=yield new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),{latitude:l,longitude:a}=t.coords,[s,n]=nt(l,a);try{const e=yield function(e,t){return o(this,null,function*(){try{const l=`https://restapi.amap.com/v3/geocode/regeo?key=329c40229e642f1afc0b46c91260c26c&location=${t},${e}&extensions=base`,a=yield fetch(l),s=yield a.json();if("1"===s.status&&s.regeocode)return s.regeocode.formatted_address;throw new Error(s.info||"地址解析失败")}catch(l){throw l}})}(s,n);et.value=e,tt.value.location=e,I.success(`位置获取成功：${e}`)}catch(e){et.value=`北纬${l.toFixed(4)}° 东经${a.toFixed(4)}°`,tt.value.location=et.value,I.warning("地址解析失败，已保存坐标信息")}}catch(t){let e="定位失败";1===t.code?e="定位权限被拒绝，请在浏览器设置中允许定位":2===t.code?e="定位位置不可用":3===t.code&&(e="定位请求超时"),I.error(e)}finally{Ze.value=!1}}else I.warning("定位功能需要HTTPS环境，请手动输入位置信息");else I.warning("您的浏览器不支持定位功能，请手动输入位置信息")})}function it(e,t=.7,l=1024){return new Promise((a,s)=>{const o=new FileReader;o.onload=o=>{const n=new Image;n.onload=()=>{const o=document.createElement("canvas");let r=n.width,i=n.height;r>l&&(i=i*l/r,r=l),o.width=r,o.height=i;o.getContext("2d").drawImage(n,0,0,r,i);let u=t;!function t(){o.toBlob(l=>{if(l)if(l.size<=51200||u<=.1){const t=new File([l],e.name,{type:"image/jpeg",lastModified:Date.now()});a(t)}else u-=.1,t();else s(new Error("图片压缩失败"))},"image/jpeg",u)}()},n.onerror=()=>s(new Error("图片加载失败")),n.src=o.target.result},o.onerror=()=>s(new Error("文件读取失败")),o.readAsDataURL(e)})}function ut(){return o(this,null,function*(){if(0!==Xe.value.length)if(tt.value.description.trim()){Ge.value=!0,Ke.value=10;try{const s=[];for(let t=0;t<Xe.value.length;t++){const l=Xe.value[t];if(Ke.value=10+t/Xe.value.length*40,l.type.startsWith("image/"))try{const e=yield it(l);s.push(e)}catch(e){s.push(l)}else s.push(l)}Ke.value=60;const o=[];for(let e=0;e<s.length;e++){const l=s[e];Ke.value=60+e/s.length*30;try{const e=yield new Promise((e,t)=>{const a=new FileReader;a.onload=t=>e(t.target.result),a.onerror=()=>t(new Error("读取失败")),a.readAsDataURL(l)});o.push({name:l.name,size:l.size,type:l.type,data:e})}catch(t){}}Ke.value=95;const n={id:Date.now(),type:"险情上报",title:"照片/视频上传",description:tt.value.description,location:tt.value.location||"未指定位置",files:o,fileCount:o.length,createTime:(new Date).toLocaleString(),status:"pending"},r=JSON.stringify([n]);try{localStorage.setItem("uploads",r),Ke.value=100,alert("上传成功！"),Xe.value=[],Ye.value=[],tt.value.description="",tt.value.location="",Ke.value=0,Qe.value&&(Qe.value.value="")}catch(l){try{localStorage.removeItem("uploads"),localStorage.setItem("uploads",r),alert("上传成功！（已清理旧数据）"),Xe.value=[],Ye.value=[],tt.value.description="",tt.value.location="",Ke.value=0,Qe.value&&(Qe.value.value="")}catch(a){alert("保存失败，存储空间不足，请清理浏览器缓存")}}}catch(t){alert("上传失败: "+t.message)}finally{Ge.value=!1}}else alert("请填写说明");else alert("请先选择照片或视频")})}function dt(){return o(this,null,function*(){if(lt.value.title.trim()){Ge.value=!0;try{const e=JSON.parse(localStorage.getItem("uploads")||"[]");e.unshift({id:Date.now(),type:"任务",title:lt.value.title,description:lt.value.content,deadline:lt.value.deadline,responsible:lt.value.responsible,createTime:(new Date).toLocaleString(),status:"pending"}),localStorage.setItem("uploads",JSON.stringify(e.slice(0,3))),yield M.uploadData({type:"任务",title:lt.value.title,description:lt.value.content,deadline:lt.value.deadline,responsible:lt.value.responsible}),I.success("提交成功"),lt.value={title:"",content:"",deadline:"",responsible:""}}catch(e){I.error("提交失败")}finally{Ge.value=!1}}else I.warning("请填写任务名称")})}function ct(){return o(this,null,function*(){if(at.value.situation.trim()){Ge.value=!0;try{const e=JSON.parse(localStorage.getItem("uploads")||"[]");e.unshift({id:Date.now(),type:"工作动态",title:"一日工作动态",date:at.value.date,situation:at.value.situation,inspection:at.value.inspection,issues:at.value.issues,measures:at.value.measures,plan:at.value.plan,createTime:(new Date).toLocaleString(),status:"pending"}),localStorage.setItem("uploads",JSON.stringify(e.slice(0,3))),yield M.uploadData(((e,o)=>{for(var n in o||(o={}))l.call(o,n)&&s(e,n,o[n]);if(t)for(var n of t(o))a.call(o,n)&&s(e,n,o[n]);return e})({type:"工作动态",title:"一日工作动态"},at.value)),I.success("提交成功")}catch(e){I.error("提交失败")}finally{Ge.value=!1}}else I.warning("请填写值守情况")})}const pt=n([]),mt=n(!1);function yt(){mt.value=!0;try{const e=localStorage.getItem("uploads");e&&(pt.value=JSON.parse(e))}catch(e){}finally{mt.value=!1}}const gt=w(()=>{const e=Xe.value.length;return e>0?`已选择 ${e} 个文件`:""}),vt=w(()=>pt.value.length);return r(We,e=>{"history"===e&&yt()}),i(()=>{yt()}),(e,t)=>(u(),d("div",j,[c("div",P,[c("div",S,[(u(!0),d(p,null,m([{key:"photo",label:"险情上报"},{key:"task",label:"任务上报"},{key:"report",label:"工作动态"},{key:"history",label:`上传记录 (${vt.value})`}],e=>(u(),d("button",{key:e.key,onClick:t=>We.value=e.key,class:g([We.value===e.key?"bg-primary-600 text-white":"bg-gray-100 text-gray-700","flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-colors"])},v(e.label),11,U))),128))])]),c("div",V,["photo"===We.value?(u(),d("div",L,[c("div",O,[t[21]||(t[21]=c("h3",{class:"text-sm font-bold text-gray-700 mb-2"},"上传照片/视频",-1)),Ye.value.length>0?(u(),d("div",D,[c("div",z,[(u(!0),d(p,null,m(Ye.value,(e,l)=>(u(),d("div",{key:l,class:"relative aspect-square bg-gray-100 rounded overflow-hidden"},["image"===e.type?(u(),d("img",{key:0,src:e.url,alt:e.name,class:"w-full h-full object-cover"},null,8,A)):(u(),d("video",{key:1,src:e.url,class:"w-full h-full object-cover",controls:""},null,8,E)),c("button",{onClick:e=>function(e){Xe.value.splice(e,1),Ye.value.splice(e,1),Qe.value&&(Qe.value.value="")}(l),class:"absolute top-0.5 right-0.5 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center shadow hover:bg-red-600 transition-colors"},[...t[12]||(t[12]=[c("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,B)]))),128))])])):y("",!0),c("div",{class:g(["border-2 border-dashed rounded-lg p-3 text-center mb-3 transition-colors",Ye.value.length>0?"border-primary-300 bg-primary-50":"border-gray-300"])},[c("input",{ref_key:"fileInput",ref:Qe,type:"file",accept:"image/*,video/*",multiple:"",class:"hidden",onChange:ot},null,544),t[13]||(t[13]=c("svg",{class:"w-8 h-8 text-gray-400 mx-auto mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),t[14]||(t[14]=c("p",{class:"text-xs text-gray-600 mb-1"},"支持图片和视频，最多9个文件",-1)),gt.value?(u(),d("p",N,v(gt.value),1)):y("",!0),c("button",{onClick:st,disabled:Ge.value,class:"px-4 py-1.5 bg-primary-600 text-white rounded text-xs font-medium hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},v(Ye.value.length>0?"继续添加":"选择文件"),9,H)],2),Ge.value&&Ke.value>0?(u(),d("div",R,[c("div",T,[t[15]||(t[15]=c("span",{class:"text-xs text-gray-600"},"上传中...",-1)),c("span",$,v(Math.round(Ke.value))+"%",1)]),c("div",J,[c("div",{class:"bg-primary-600 h-1.5 rounded-full transition-all duration-300",style:b({width:Ke.value+"%"})},null,4)])])):y("",!0),c("div",_,[c("div",null,[t[18]||(t[18]=c("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"位置信息",-1)),c("div",q,[f(c("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>tt.value.location=e),type:"text",placeholder:"自动获取或手动输入位置",disabled:Ge.value,class:"flex-1 px-2.5 py-1.5 border border-gray-300 rounded text-xs focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100 disabled:cursor-not-allowed"},null,8,F),[[h,tt.value.location]]),c("button",{onClick:rt,disabled:Ge.value||Ze.value,class:"px-2.5 py-1.5 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[Ze.value?(u(),d("svg",G,[...t[16]||(t[16]=[c("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),c("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(u(),d("svg",K,[...t[17]||(t[17]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},null,-1)])]))],8,W)])]),c("div",null,[t[19]||(t[19]=c("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"说明",-1)),f(c("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>tt.value.description=e),rows:"2",placeholder:"请简要描述险情情况",disabled:Ge.value,class:"w-full px-2.5 py-1.5 border border-gray-300 rounded text-xs focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100 disabled:cursor-not-allowed"},null,8,Q),[[h,tt.value.description]])]),c("button",{onClick:ut,disabled:Ge.value||0===Xe.value.length,class:"w-full py-2 bg-emergency-600 text-white rounded text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-emergency-700 transition-colors"},[Ge.value?(u(),d("span",Y,[t[20]||(t[20]=c("svg",{class:"animate-spin -ml-1 mr-2 h-3.5 w-3.5 text-white",fill:"none",viewBox:"0 0 24 24"},[c("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),c("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),x(" 上传中... "+v(Math.round(Ke.value))+"% ",1)])):(u(),d("span",Z,"立即上报"))],8,X)])])])):y("",!0),"task"===We.value?(u(),d("div",ee,[c("div",te,[t[26]||(t[26]=c("h3",{class:"text-sm font-bold text-gray-700 mb-3"},"临时工作任务",-1)),c("div",le,[c("div",null,[t[22]||(t[22]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"任务名称",-1)),f(c("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>lt.value.title=e),type:"text",placeholder:"请输入任务名称",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,ae),[[h,lt.value.title]])]),c("div",null,[t[23]||(t[23]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"任务内容",-1)),f(c("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>lt.value.content=e),rows:"3",placeholder:"请详细描述任务内容",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,se),[[h,lt.value.content]])]),c("div",null,[t[24]||(t[24]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"完成时间",-1)),f(c("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>lt.value.deadline=e),type:"datetime-local",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,oe),[[h,lt.value.deadline]])]),c("div",null,[t[25]||(t[25]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"责任人",-1)),f(c("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>lt.value.responsible=e),type:"text",placeholder:"请输入责任人",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,ne),[[h,lt.value.responsible]])]),c("button",{onClick:dt,disabled:Ge.value,class:"w-full py-3 bg-emergency-600 text-white rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"},v(Ge.value?"提交中...":"提交任务"),9,re)])])])):y("",!0),"report"===We.value?(u(),d("div",ie,[c("div",ue,[t[33]||(t[33]=c("h3",{class:"text-sm font-bold text-gray-700 mb-3"},"一日工作动态汇总",-1)),c("div",de,[c("div",null,[t[27]||(t[27]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"日期",-1)),f(c("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>at.value.date=e),type:"date",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,ce),[[h,at.value.date]])]),c("div",null,[t[28]||(t[28]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"值守情况",-1)),f(c("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>at.value.situation=e),rows:"2",placeholder:"简要描述当日值守情况",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,pe),[[h,at.value.situation]])]),c("div",null,[t[29]||(t[29]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"巡查点位",-1)),f(c("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>at.value.inspection=e),rows:"2",placeholder:"记录巡查的点位及情况",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,me),[[h,at.value.inspection]])]),c("div",null,[t[30]||(t[30]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"发现问题",-1)),f(c("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>at.value.issues=e),rows:"2",placeholder:"记录发现的问题",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,ye),[[h,at.value.issues]])]),c("div",null,[t[31]||(t[31]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"处置措施",-1)),f(c("textarea",{"onUpdate:modelValue":t[10]||(t[10]=e=>at.value.measures=e),rows:"2",placeholder:"记录采取的处置措施",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,ge),[[h,at.value.measures]])]),c("div",null,[t[32]||(t[32]=c("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"明日计划",-1)),f(c("textarea",{"onUpdate:modelValue":t[11]||(t[11]=e=>at.value.plan=e),rows:"2",placeholder:"填写明日工作计划",disabled:Ge.value,class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-100"},null,8,ve),[[h,at.value.plan]])]),c("button",{onClick:ct,disabled:Ge.value,class:"w-full py-3 bg-emergency-600 text-white rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"},v(Ge.value?"提交中...":"提交汇总"),9,be)])])])):y("",!0),"history"===We.value?(u(),d("div",fe,[mt.value?(u(),d("div",he,[...t[34]||(t[34]=[c("div",{class:"inline-block w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"},null,-1),c("p",{class:"text-sm text-gray-500 mt-2"},"加载中...",-1)])])):0===pt.value.length?(u(),d("div",xe,[...t[35]||(t[35]=[c("svg",{class:"w-16 h-16 text-gray-300 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.707.293H19a2 2 0 012-2z"})],-1),c("p",{class:"text-sm text-gray-500"},"暂无上传记录",-1),c("p",{class:"text-xs text-gray-400 mt-1"},"上传的照片和任务将显示在这里",-1)])])):(u(),d("div",we,[(u(!0),d(p,null,m(pt.value,e=>(u(),d("div",{key:e.id,class:"bg-white p-4 rounded-xl shadow-sm"},[c("div",ke,[c("div",Me,[c("div",Ce,[c("span",{class:g({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-red-100 text-red-700":"险情上报"===e.type,"bg-blue-100 text-blue-700":"任务"===e.type,"bg-green-100 text-green-700":"工作动态"===e.type})},v(e.type),3),c("span",Ie,v(e.createTime),1)]),c("h4",je,v(e.title),1)]),c("button",{onClick:t=>{return l=e.id,void(confirm("确定要删除这条记录吗？")&&(pt.value=pt.value.filter(e=>e.id!==l),localStorage.setItem("uploads",JSON.stringify(pt.value)),I.success("删除成功")));var l},class:"text-red-600 p-1 hover:bg-red-50 rounded",title:"删除"},[...t[36]||(t[36]=[c("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Pe)]),e.description?(u(),d("p",Se,v(e.description),1)):y("",!0),"任务"===e.type?(u(),d("div",Ue,[e.deadline?(u(),d("p",Ve,[t[37]||(t[37]=c("span",{class:"font-medium"},"完成时间:",-1)),x(" "+v(e.deadline),1)])):y("",!0),e.responsible?(u(),d("p",Le,[t[38]||(t[38]=c("span",{class:"font-medium"},"责任人:",-1)),x(" "+v(e.responsible),1)])):y("",!0)])):y("",!0),"工作动态"===e.type?(u(),d("div",Oe,[e.date?(u(),d("p",De,[t[39]||(t[39]=c("span",{class:"font-medium"},"日期:",-1)),x(" "+v(e.date),1)])):y("",!0),e.situation?(u(),d("p",ze,[t[40]||(t[40]=c("span",{class:"font-medium"},"值守情况:",-1)),x(" "+v(e.situation),1)])):y("",!0),e.inspection?(u(),d("p",Ae,[t[41]||(t[41]=c("span",{class:"font-medium"},"巡查点位:",-1)),x(" "+v(e.inspection),1)])):y("",!0),e.issues?(u(),d("p",Ee,[t[42]||(t[42]=c("span",{class:"font-medium"},"发现问题:",-1)),x(" "+v(e.issues),1)])):y("",!0),e.measures?(u(),d("p",Be,[t[43]||(t[43]=c("span",{class:"font-medium"},"处置措施:",-1)),x(" "+v(e.measures),1)])):y("",!0),e.plan?(u(),d("p",Ne,[t[44]||(t[44]=c("span",{class:"font-medium"},"明日计划:",-1)),x(" "+v(e.plan),1)])):y("",!0)])):y("",!0),e.files&&e.files.length>0?(u(),d("div",He,[c("div",Re,[(u(!0),d(p,null,m(e.files,(e,l)=>(u(),d("div",{key:l,class:"aspect-square bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:t=>function(e){const t=document.createElement("div");t.className="fixed inset-0 z-[200] flex items-center justify-center bg-black/80",t.onclick=()=>t.remove();const l=document.createElement("img");l.src=e,l.className="max-w-[90vw] max-h-[90vh] object-contain",l.onclick=e=>e.stopPropagation(),t.appendChild(l),document.body.appendChild(t)}(e.data)},[e.type&&e.type.startsWith("image/")?(u(),d("img",{key:0,src:e.data,alt:e.name,class:"w-full h-full object-cover"},null,8,$e)):(u(),d("div",Je,[...t[45]||(t[45]=[c("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.364a1 1 0 01-1.447.894L15 14M5 12h14"})],-1)])]))],8,Te))),128))]),c("p",_e,"共 "+v(e.files.length)+" 个文件",1)])):y("",!0),e.location?(u(),d("div",qe,[t[46]||(t[46]=c("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})],-1)),c("span",null,v(e.location),1)])):y("",!0),e.status?(u(),d("div",Fe,[c("span",{class:g({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-700":"pending"===e.status,"bg-blue-100 text-blue-700":"processing"===e.status,"bg-green-100 text-green-700":"completed"===e.status})},v("pending"===e.status?"待处理":"processing"===e.status?"处理中":"已完成"),3)])):y("",!0)]))),128))]))])):y("",!0)])]))}},[["__scopeId","data-v-76911479"]]);export{We as default};
